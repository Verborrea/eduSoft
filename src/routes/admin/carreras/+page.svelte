<script lang="ts">
	import type { Career } from '$lib/types'

	let selection: string[] = [];

	export let data

	let editModal: any
	let currentCareer: Career
	let editingCareerId: string
	let editingCareerName: string
	let editingCarrerShortName: string
	
	function openModal(career: any) {
		currentCareer = career

		editingCareerId = career.id
		editingCareerName = career.name
		editingCarrerShortName = career.short_name

		editModal.showModal()
	}

	function closeModal() {
		editModal.close()
	}
</script>

<svelte:head>
	<title>eduSoft | Carreras</title>
</svelte:head>

<dialog bind:this={editModal}>
	<form class="fcol16" action="?/edit" method="post">
		<h1>Editar Carrera</h1>
		<input class="none" type="text" name="id" value={editingCareerId}>
		<div class="input-field fcol16">
			<label for="o_name">Nombre Oficial:</label>
			<input name="o_name" class="input" type="text" bind:value={editingCareerName}>
		</div>
		<div class="input-field fcol16">
			<label for="abrv">Abreviación:</label>
			<input name="abrv" class="input" type="text" bind:value={editingCarrerShortName}>
		</div>
		<div class="dialog-buttons">
			<button class="btn btn-secondary" on:click={closeModal}>Cancelar</button>
			<button type="submit" class="btn btn-primary">
				<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 6V15.5C17 15.9125 16.8531 16.2656 16.5594 16.5594C16.2656 16.8531 15.9125 17 15.5 17H4.5C4.0875 17 3.73437 16.8531 3.44062 16.5594C3.14687 16.2656 3 15.9125 3 15.5V4.5C3 4.0875 3.14687 3.73438 3.44062 3.44063C3.73437 3.14688 4.0875 3 4.5 3H14L17 6ZM10 14.75C10.625 14.75 11.1562 14.5312 11.5938 14.0938C12.0312 13.6562 12.25 13.125 12.25 12.5C12.25 11.875 12.0312 11.3438 11.5938 10.9062C11.1562 10.4688 10.625 10.25 10 10.25C9.375 10.25 8.84375 10.4688 8.40625 10.9062C7.96875 11.3438 7.75 11.875 7.75 12.5C7.75 13.125 7.96875 13.6562 8.40625 14.0938C8.84375 14.5312 9.375 14.75 10 14.75ZM5.5 8.5H12.5V5.5H5.5V8.5Z" fill="white"/></svg>
				Guardar
			</button>
		</div>
	</form>
</dialog>

<div class="main">
	<header class="fc">
		<h1>Carreras Profesionales</h1>
	</header>

	<form class="upbar g24" action="?/create" method="post">
		<input type="text" class="input" name="name" placeholder="Nombre Oficial">
		<input type="text" class="input" name="sname" placeholder="Abreviación">
		<button class="btn btn-primary">
			<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M13.0608 3.26083C13.5486 2.77305 14.2102 2.49902 14.9 2.49902C15.2416 2.49902 15.5798 2.5663 15.8953 2.69701C16.2109 2.82772 16.4976 3.01931 16.7392 3.26083C16.9807 3.50235 17.1723 3.78908 17.303 4.10465C17.4337 4.42021 17.501 4.75843 17.501 5.1C17.501 5.44156 17.4337 5.77978 17.303 6.09535C17.1723 6.41091 16.9807 6.69764 16.7392 6.93916L11.7917 11.8867C11.1544 12.5243 10.3274 12.9381 9.435 13.0658L7.61833 13.3242C7.49033 13.3425 7.35982 13.3308 7.23712 13.29C7.11442 13.2492 7.0029 13.1804 6.91138 13.089C6.81986 12.9977 6.75086 12.8863 6.70983 12.7637C6.66881 12.641 6.65688 12.5105 6.675 12.3825L6.93417 10.5658C7.06175 9.6731 7.47551 8.84585 8.11333 8.20833L13.0608 3.26083ZM15.5608 4.43916C15.4741 4.35224 15.3711 4.28327 15.2577 4.23621C15.1443 4.18915 15.0228 4.16493 14.9 4.16493C14.7772 4.16493 14.6557 4.18915 14.5423 4.23621C14.4289 4.28327 14.3259 4.35224 14.2392 4.43916L9.29167 9.38666C8.90904 9.76909 8.66078 10.2653 8.58417 10.8008L8.48167 11.5175L9.19833 11.4158C9.73415 11.3394 10.2307 11.0911 10.6133 10.7083L15.5608 5.76083C15.6478 5.67413 15.7167 5.57113 15.7638 5.45774C15.8108 5.34434 15.8351 5.22277 15.8351 5.1C15.8351 4.97722 15.8108 4.85566 15.7638 4.74226C15.7167 4.62886 15.6478 4.52586 15.5608 4.43916ZM9.16667 3.33333C9.16667 3.55435 9.07887 3.76631 8.92259 3.92259C8.76631 4.07887 8.55435 4.16666 8.33333 4.16666C7.50167 4.16666 6.915 4.17333 6.45583 4.21666C6.00583 4.26 5.7375 4.33416 5.53167 4.43916C5.06128 4.67884 4.67885 5.06128 4.43917 5.53166C4.3275 5.75083 4.25083 6.04083 4.20917 6.545C4.1675 7.05916 4.16667 7.72 4.16667 8.66666V11.3333C4.16667 12.2808 4.16667 12.9408 4.20917 13.455C4.25083 13.9592 4.3275 14.2492 4.43917 14.4683C4.67885 14.9387 5.06128 15.3212 5.53167 15.5608C5.75083 15.6725 6.04083 15.7492 6.545 15.7908C7.05917 15.8325 7.72 15.8333 8.66667 15.8333H11.3333C12.2808 15.8333 12.9408 15.8333 13.455 15.7908C13.9592 15.7492 14.2492 15.6725 14.4683 15.5608C14.9387 15.3212 15.3212 14.9387 15.5608 14.4683C15.6658 14.2625 15.74 13.9942 15.7825 13.545C15.8267 13.085 15.8325 12.4983 15.8325 11.6658C15.8326 11.5564 15.8543 11.4481 15.8963 11.347C15.9382 11.2459 15.9997 11.1541 16.0772 11.0768C16.1546 10.9995 16.2466 10.9382 16.3477 10.8964C16.4488 10.8547 16.5572 10.8332 16.6667 10.8333C16.7761 10.8334 16.8844 10.8551 16.9855 10.8971C17.0866 10.9391 17.1784 11.0005 17.2557 11.078C17.333 11.1555 17.3943 11.2474 17.4361 11.3485C17.4778 11.4497 17.4993 11.5581 17.4992 11.6675C17.4992 12.4825 17.4942 13.1508 17.4417 13.7025C17.3883 14.2633 17.2817 14.7608 17.0458 15.225C16.6464 16.009 16.009 16.6464 15.225 17.0458C14.7317 17.2975 14.1983 17.4025 13.5908 17.4517C13 17.5 12.2725 17.5 11.3692 17.5H8.63083C7.7275 17.5 6.99917 17.5 6.40917 17.4517C5.8025 17.4017 5.26833 17.2975 4.77583 17.0458C3.99155 16.6465 3.35385 16.0091 2.95417 15.225C2.7025 14.7317 2.5975 14.1975 2.54833 13.5908C2.5 13 2.5 12.2725 2.5 11.3692V8.63083C2.5 7.7275 2.5 6.99916 2.54833 6.40916C2.59833 5.80166 2.7025 5.26833 2.95417 4.775C3.35363 3.99102 3.99103 3.35363 4.775 2.95416C5.23833 2.7175 5.73667 2.61166 6.2975 2.55833C6.85 2.50583 7.5175 2.5 8.33333 2.5C8.55435 2.5 8.76631 2.5878 8.92259 2.74408C9.07887 2.90036 9.16667 3.11232 9.16667 3.33333Z" fill="white"/>
			</svg>				
			Añadir Carrera
		</button>
	</form>

	<table>
		<thead>
			<tr>
				<th>#</th>
				<th>NOMBRE OFICIAL</th>
				<th>ABREVIACIÓN</th>
				<th>CREACIÓN</th>
				<th>OPCIONES</th>
			</tr>
		</thead>
		<tbody>
		{#each data.carreras as carrera, index}
		<tr>
			<td> <div class="cell-fc">
				{(data.page - 1) * data.perPage + index + 1}
			</div> </td>
			<td> {carrera.name} </td>
			<td> {carrera.short_name} </td>
			<td>
				<div class="cell-fc">
				{new Date(carrera.created).toLocaleDateString('es-PE')}
				</div>
			</td>
			<td>
				<div class="cell-fc optns">

					<button class="edit" on:click={e => openModal(carrera)}>
						<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M11.0775 3.57749C11.4263 3.21697 11.8434 2.92949 12.3044 2.7318C12.7655 2.53411 13.2613 2.43017 13.7629 2.42603C14.2645 2.42189 14.762 2.51765 15.2262 2.7077C15.6905 2.89776 16.1122 3.17832 16.4669 3.53304C16.8217 3.88776 17.1022 4.30953 17.2923 4.77377C17.4823 5.23802 17.5781 5.73545 17.5739 6.23708C17.5698 6.73871 17.4659 7.23449 17.2682 7.69554C17.0705 8.15659 16.783 8.57367 16.4225 8.92249L15.5892 9.75582L9.67749 15.6675C9.06349 16.2813 8.27306 16.6881 7.41665 16.8308L3.46999 17.4892C3.33918 17.5109 3.20508 17.501 3.07884 17.4605C2.95259 17.4199 2.83785 17.3499 2.74413 17.2561C2.65041 17.1623 2.58043 17.0474 2.53999 16.9212C2.49956 16.7949 2.48985 16.6608 2.51165 16.53L3.16915 12.5833C3.31191 11.7269 3.71863 10.9365 4.33249 10.3225L11.0775 3.57749ZM10.8333 6.17832L5.51165 11.5008C5.14319 11.8692 4.89903 12.3435 4.81332 12.8575L4.34665 15.6533L7.14249 15.1867C7.65633 15.1012 8.13064 14.8573 8.49915 14.4892L13.8217 9.16666L10.8333 6.17832ZM15 7.98833L12.0117 4.99999L12.2558 4.75582C12.6542 4.36981 13.1884 4.15591 13.7431 4.16028C14.2978 4.16465 14.8285 4.38695 15.2208 4.77919C15.613 5.17144 15.8353 5.70219 15.8397 6.25689C15.8441 6.81159 15.6302 7.34578 15.2442 7.74416L15 7.98833Z" fill="#F2BD2C"/>
						</svg>						
					</button>

					<form class="remove" method="post" action="?/delete">
						<input class="none" name="id" type="text" value={carrera.id}>
						<button>	
							<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path fill-rule="evenodd" clip-rule="evenodd" d="M8.79667 3.33335C8.61156 3.33308 8.43163 3.39444 8.28526 3.50776C8.1389 3.62108 8.03443 3.77991 7.98833 3.95919L7.745 4.90919H12.2625L12.0183 3.95919C11.9723 3.78005 11.8679 3.62132 11.7217 3.50802C11.5755 3.39471 11.3958 3.33326 11.2108 3.33335H8.79667ZM13.9833 4.91002L13.6325 3.54419C13.4944 3.00691 13.1815 2.53083 12.743 2.19093C12.3046 1.85102 11.7656 1.6666 11.2108 1.66669H8.79667C8.24191 1.6666 7.70289 1.85102 7.26447 2.19093C6.82605 2.53083 6.51313 3.00691 6.375 3.54419L6.02417 4.91002H3.33333C3.11232 4.91002 2.90036 4.99782 2.74408 5.1541C2.5878 5.31038 2.5 5.52234 2.5 5.74335C2.5 5.96437 2.5878 6.17633 2.74408 6.33261C2.90036 6.48889 3.11232 6.57669 3.33333 6.57669H3.41667L4.42917 16.0975C4.49442 16.7116 4.78467 17.2798 5.24396 17.6927C5.70326 18.1055 6.29911 18.3337 6.91667 18.3334H13.0833C13.7008 18.3335 14.2964 18.1052 14.7555 17.6924C15.2146 17.2796 15.5048 16.7115 15.57 16.0975L16.5817 6.57669H16.6667C16.8877 6.57669 17.0996 6.48889 17.2559 6.33261C17.4122 6.17633 17.5 5.96437 17.5 5.74335C17.5 5.52234 17.4122 5.31038 17.2559 5.1541C17.0996 4.99782 16.8877 4.91002 16.6667 4.91002H13.9833ZM14.9067 6.57669H5.09333L6.08667 15.9217C6.1085 16.1265 6.20539 16.3159 6.35866 16.4535C6.51193 16.5911 6.71071 16.667 6.91667 16.6667H13.0833C13.2891 16.6668 13.4877 16.5908 13.6408 16.4532C13.7939 16.3157 13.8907 16.1263 13.9125 15.9217L14.9067 6.57669ZM8.33333 8.33335C8.55435 8.33335 8.76631 8.42115 8.92259 8.57743C9.07887 8.73371 9.16667 8.94567 9.16667 9.16669V13.3334C9.16667 13.5544 9.07887 13.7663 8.92259 13.9226C8.76631 14.0789 8.55435 14.1667 8.33333 14.1667C8.11232 14.1667 7.90036 14.0789 7.74408 13.9226C7.5878 13.7663 7.5 13.5544 7.5 13.3334V9.16669C7.5 8.94567 7.5878 8.73371 7.74408 8.57743C7.90036 8.42115 8.11232 8.33335 8.33333 8.33335ZM11.6667 8.33335C11.8877 8.33335 12.0996 8.42115 12.2559 8.57743C12.4122 8.73371 12.5 8.94567 12.5 9.16669V13.3334C12.5 13.5544 12.4122 13.7663 12.2559 13.9226C12.0996 14.0789 11.8877 14.1667 11.6667 14.1667C11.4457 14.1667 11.2337 14.0789 11.0774 13.9226C10.9211 13.7663 10.8333 13.5544 10.8333 13.3334V9.16669C10.8333 8.94567 10.9211 8.73371 11.0774 8.57743C11.2337 8.42115 11.4457 8.33335 11.6667 8.33335Z" fill="#FF595E"/>
							</svg>						
						</button>
					</form>

					<svg class="dots" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M5.49563 11.5C5.08188 11.5 4.72917 11.3527 4.4375 11.0581C4.14583 10.7635 4 10.4094 4 9.99563C4 9.58188 4.14729 9.22917 4.44188 8.9375C4.73646 8.64583 5.09062 8.5 5.50437 8.5C5.91812 8.5 6.27083 8.64729 6.5625 8.94188C6.85417 9.23646 7 9.59062 7 10.0044C7 10.4181 6.85271 10.7708 6.55813 11.0625C6.26354 11.3542 5.90938 11.5 5.49563 11.5ZM9.99563 11.5C9.58188 11.5 9.22917 11.3527 8.9375 11.0581C8.64583 10.7635 8.5 10.4094 8.5 9.99563C8.5 9.58188 8.64729 9.22917 8.94187 8.9375C9.23646 8.64583 9.59062 8.5 10.0044 8.5C10.4181 8.5 10.7708 8.64729 11.0625 8.94188C11.3542 9.23646 11.5 9.59062 11.5 10.0044C11.5 10.4181 11.3527 10.7708 11.0581 11.0625C10.7635 11.3542 10.4094 11.5 9.99563 11.5ZM14.4956 11.5C14.0819 11.5 13.7292 11.3527 13.4375 11.0581C13.1458 10.7635 13 10.4094 13 9.99563C13 9.58188 13.1473 9.22917 13.4419 8.9375C13.7365 8.64583 14.0906 8.5 14.5044 8.5C14.9181 8.5 15.2708 8.64729 15.5625 8.94188C15.8542 9.23646 16 9.59062 16 10.0044C16 10.4181 15.8527 10.7708 15.5581 11.0625C15.2635 11.3542 14.9094 11.5 14.4956 11.5Z" fill="#1C1B1F"/>
					</svg>
			</td>
		</tr>
		{/each}
		</tbody>
	</table>
	<footer class="justify-between fc g16">
		<p>
			Mostrando
			{(data.page - 1) * data.perPage + (data.totalItems > 1 ? 1 : 0)}
			-
			{data.perPage * data.page > data.totalItems
				? data.totalItems
				: data.page * data.perPage}
			de
			{data.totalItems}
		</p>
		<div class="fc g16">
			<form>
				<button
					title="Página anterior"
					type="submit"
					class="btn btn-square"
					disabled={data.page == 1}
					on:click={() => {
						selection = [];
					}}>
						<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 6.5L8 10L12 13.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
					</button
				>
				<input type="text" class="hidden" name="page" value={data.page - 1} />
			</form>
			<p>Página {data.page} de {data.totalPages}</p>
			<form>
				<input type="text" class="hidden" name="page" value={data.page + 1}/>
				<button
					title="Página siguiente"
					type="submit"
					class="btn btn-square"
					disabled={data.page == data.totalPages}
					on:click={() => {
						selection = [];
					}}>
						<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 6.5L12 10L8 13.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
					</button
				>
			</form>
		</div>
	</footer>
</div>

<style>
	.main {
		display: flex;
		flex-direction: column;
		gap: 24px;
		padding: 24px;
	}
	h1 {
		margin: 0;
	}
	.upbar {
		display: flex;
	}
	.edit, .remove {
		display: none;
	}
	.optns {
		gap: 8px;
	}
	.optns:hover .dots {
		display: none;
	}
	.optns:hover .edit{
		display: block;
	}
	.optns:hover .remove{
		display: flex;
	}
	dialog {
	  padding: 24px;
		border-radius: 16px;
		border: none;
		width: calc(100% - 32px);
    	max-width: 622px;
	}
	.dialog-buttons {
		display: flex;
		justify-content: flex-end;
		gap: 12px;
	}
	footer p {
		font-weight: 500;
	}
</style>